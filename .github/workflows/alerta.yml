name: CI/CD con NotificaciÃ³n NTFY

# Se ejecuta cuando hay push a la rama main
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-and-notify:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout del cÃ³digo
      - name: Checkout cÃ³digo
        uses: actions/checkout@v4

      # 2. Configurar Node.js (si usas JavaScript)
      - name: Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      # 3. Ejecutar el programa
      - name: Ejecutar programa Hola Mundo
        run: node index.js

      # 4. Enviar notificaciÃ³n de Ã©xito a ntfy.sh
      - name: NotificaciÃ³n de Ã©xito
        if: success()
        run: |
          curl -d "âœ… CI/CD Exitoso - CÃ³digo desplegado en main
          ğŸ“¦ Repositorio: ${{ github.repository }}
          ğŸ‘¤ Autor: ${{ github.actor }}
          ğŸ“ Commit: ${{ github.event.head_commit.message }}
          ğŸ”— Ver cambios: ${{ github.event.head_commit.url }}" \
          -H "Title: ğŸš€ Deployment Exitoso - DevOps ITLA" \
          -H "Priority: high" \
          -H "Tags: white_check_mark,rocket,computer" \
          https://ntfy.sh/devops-itla

      # 5. Enviar notificaciÃ³n de fallo a ntfy.sh
      - name: NotificaciÃ³n de fallo
        if: failure()
        run: |
          curl -d "âŒ CI/CD FallÃ³ - Error en el deployment
          ğŸ“¦ Repositorio: ${{ github.repository }}
          ğŸ‘¤ Autor: ${{ github.actor }}
          ğŸ“ Commit: ${{ github.event.head_commit.message }}
          ğŸ”— Ver logs: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}" \
          -H "Title: ğŸš¨ Error en Deployment - DevOps ITLA" \
          -H "Priority: urgent" \
          -H "Tags: x,warning,computer" \
          https://ntfy.sh/devops-itla
